{% extends 'base.html' %}
{% block content %}

{% for studio in studios %}
<div>
    <img src="{{ studio.image_url }}">
    <h3>{{ studio.name }}</h3>
    <h4>Address:</h4>
    {% for item in studio.location.display_address %}
    <p>{{ item }}</p>
    {% endfor %}
    <h4>Categories:</h4>
    <ul>
        {% for category in studio.categories %}
        <li>{{ category.name }}</li>
        {% endfor %}
    </ul>
    <img src ="{{ studio.rating_img_url }}">
</div>
<hr>


<div>
    <h4>Ratings:</h4>
    {% if 1 > review_count %}
    <p>This studio hasn't been reviewed yet.</p>
    {% else %}
    <h6>Review count: {{ review_count }}</h6>
    <p>Overall score: {{ studio_db.overall_rating }}</p>
    <p>Amenities score: {{ studio_db.amenities_rating }}</p>
    <p>Cleanliness score: {{ studio_db.cleanliness_rating }}</p>
    <p>Class size score: {{ studio_db.class_size_rating }}</p>
    <p>Schedule score: {{ studio_db.schedule_rating }}</p>
    <p>What people are saying about the pace of this class: 
    {{ studio_db.pace_rating }}
    </p>
    {% endif %}
</div>

<div>
    <h4>Studio Reviews:</h4>
    {% if 1 > review_count %}
    <p>Be the first to review this studio!</p>
    {% endif %}
    <ul>
    {% for review in reviews %}
    <li>Overall rating: {{ review.overall_rating }},
        Amenities rating: {{ review.amenities_rating }},
        Cleanliness rating: {{ review.cleanliness_rating }},
        Class size rating: {{ review.class_size_rating }},
        Schedule rating: {{ review.schedule_rating }},
        Pace rating: {{ review.pace_rating }}
    </li>
    {% endfor %}
    </ul>
</div>

<div>
    <h4>Top Instructors:</h4>
    <p></p>
</div>

<div>
    <h4>Top Classes:</h4>
    <p></p>
</div>

<div>
    <h4>Instructor Reviews:</h4>
    <ul>
    {% for instructor in instructors %}
        {% for review in instructor.instructorreviews %}
        <li>{{ review.instructor.name }}, {{ review.rating }}</li>
        {% endfor %}
    {% endfor %}
    </ul>
</div>

<div id="map" data-latitude={{ latitude }} data-longitude={{ longitude }} data-name={{ name }}></div>

{% if session.user %}
<a href="/write-a-review/{{ id }}"><button type="button">Review this studio</button></a>


{% if favorited %}
<div id="favorite-div">
    <button style="color:red" id="favorite" data-id={{ id }}>
        <span class="glyphicon glyphicon-heart"></span> Favorite
    </button>
    <span id="notes"></span>
    <span id="favorite-studio">This is one of your favorites!</span>
</div>
{% endif %}

{% if not favorited %}
<div id="favorite-div">
    <button id="favorite" data-id={{ id }}>
        <span class="glyphicon glyphicon-heart"></span> Favorite
    </button>
    <span id="notes"></span>
    <span id="favorite-studio"></span>
</div>
{% endif %}

{% endif %}

{% endfor %}


    <script>

        //send the studio id to the server and query the db to check if
        //the button has already been favorited...apply styling and
        //send info to route for adding/removing from db
       function checkFavorite(evt) {
            var data = {
                        "studio_id": $("#favorite").data('id'),
                        };
          $.get('/check-if-favorite', data, function (results) {
            // debugger
                if (results == "false") {
                    $.post('/favorite/studio', data, function (data) {
                        $('#favorite-studio').text('You favorited this!');
                        $('#favorite').css('color', 'red');
                        });
                    }
                else if (results == "true") {
                    $.post('/unfavorite/studio', data, function (data) {
                        $('#favorite-studio').text('You unfavorited this.');
                        $('#favorite').css('color', '');
                        });  
                    }
                });
            }


        $('#favorite').on('click', checkFavorite);

        var latitude = $("#map").data('latitude');

        var longitude = $("#map").data('longitude');

        var name = $("#map").data('name');

        // google.maps.event.addDomListener(window, 'load', initMap);

        var map;
        function initMap() {
            var myLatLng = {lat: latitude, lng: longitude}
            map = new google.maps.Map(document.getElementById('map'), {
              center: myLatLng,
              zoom: 15
            });
              
            var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                title: name
                });
        }

    
    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOw5Cog-7VVeGLqF9TRxbHu81-RxKdKUk&callback=initMap">
    </script>


{% endblock %}