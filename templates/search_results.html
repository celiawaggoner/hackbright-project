{% extends 'base.html' %}
{% block content %}

<span id="zipcode" data-zipcode={{ zipcode }}></span>
{% for studio in studios %}
<div>
    <img src="{{ studio.image_url }}">
    <h3><a href="{{ url_for('show_studio_profile', studio_id = studio.id)}}">{{ studio.name }}</a></h3>
    <h4>Address:</h4>
    {% for item in studio.location.display_address %}
    <p>{{ item }}</p>
    {% endfor %}
    <h4>Categories:</h4>
    <ul>
        {% for category in studio.categories %}
        <li>{{ category.name }}</li>
        {% endfor %}
    </ul>
    <img src ="{{ studio.rating_img_url }}">
</div>
<hr>
{% endfor %}

<div id="bigmap"></div>


<script>

        
        // debugger

        //json string into object
        var map;

            function initMap() {
            
            map = new google.maps.Map(document.getElementById('bigmap'), {
                center: {lat: {{ lat }}, lng: {{ lng }}},
                zoom: 14
            });

                 var data = {
                            "zipcode": $("#zipcode").data('zipcode'),
                            };
                $.get('/studios.json', data, function (results) {

                    // var markers = JSON.parse(results);

                    var markers = results;

                    // console.log(markers);

                        for (var key in markers) {
                            var lat = markers[key].latitude;
                            var lng = markers[key].longitude;
                            var myLatLng = {lat, lng};
                             var marker = new google.maps.Marker({
                                position: myLatLng,
                                map: map,
                                title: key
                                });
                            }
                        });
                    }


            
        

        // createMap()
        // google.maps.event.addDomListener(window, 'load', initMap);


</script>

    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOw5Cog-7VVeGLqF9TRxbHu81-RxKdKUk&callback=initMap">
    </script>

{% endblock %}